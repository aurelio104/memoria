<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Juego de Memoria</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-title" content="Juego de Memoria">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover">
  <link rel="apple-touch-icon" href="assets/icon192.png">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" type="image/png" href="assets/icon192.png">
  <link rel="stylesheet" href="style.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@700&display=swap" rel="stylesheet">
  <style>
    .form-screen {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.65);
      display: flex;
      justify-content: center;
      align-items: center;
      backdrop-filter: blur(10px);
      z-index: 999;
      animation: fadeIn 0.6s ease;
    }
    .form-glass {
      background: rgba(255, 255, 255, 0.08);
      padding: 2rem;
      border-radius: 1.5rem;
      backdrop-filter: blur(30px);
      box-shadow: 0 0 30px rgba(0,0,0,0.5);
      text-align: center;
      width: 90%;
      max-width: 350px;
      color: white;
      font-family: "Poppins", sans-serif;
      animation: popIn 0.4s ease;
    }
    .form-glass input, .form-glass button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 12px;
      border: none;
      font-size: 1rem;
      outline: none;
    }
    .form-glass input {
      background: rgba(255,255,255,0.1);
      color: white;
    }
    .form-glass button {
      background: #00ffff;
      font-weight: bold;
      color: #000;
      cursor: pointer;
      transition: transform 0.2s ease;
    }
    .form-glass button:active {
      transform: scale(0.95);
    }
    @keyframes fadeIn {
      from { opacity: 0 } to { opacity: 1 }
    }
    @keyframes popIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
  </style>
</head>
<body>
  <!-- Formulario (inicial, solo si no hay datos guardados) -->
  <section id="formScreen" style="display: none;" class="form-screen">
    <form id="playerForm" class="form-glass">
      <h2>üë§ Tus datos</h2>
      <input type="text" id="firstName" placeholder="Nombre" required />
      <input type="text" id="lastName" placeholder="Apellido" required />
      <input type="email" id="email" placeholder="Correo" required />
      <button type="submit">Continuar</button>
    </form>
  </section>

  <!-- Splash Screen -->
  <section id="splashScreen">
    <img id="splashImage" src="assets/BAM_INTRO.jpg" alt="Intro BAM" />
    <video autoplay muted playsinline id="splashVideo" style="display: none;">
      <source src="assets/BAM_INTRO.mp4" type="video/mp4" />
    </video>
  </section>

  <!-- Fondo -->
  <video autoplay muted loop playsinline id="backgroundVideo">
    <source id="bgSource" src="assets/pagina_1.mp4" type="video/mp4">
  </video>

  <!-- Inicio -->
  <section id="screenStart" style="display: none;">
    <img src="assets/star.png" alt="Iniciar juego" id="playButton" class="start-button" />
    <img src="assets/logo-BAM.png" alt="Logo BAM" class="logo-bam" />
  </section>

  <!-- Juego -->
  <section id="screenGame" style="display: none;">
    <div id="gameContainer">
      <video autoplay muted loop playsinline id="frameVideo">
        <source src="assets/Cuadro.mp4" type="video/mp4">
      </video>
      <div id="puzzleContainer"></div>
    </div>
  </section>

  <!-- Pantalla Final -->
  <section id="screenThanks" style="display: none;">
    <video autoplay muted loop playsinline id="congratsVideo">
      <source src="assets/congratulacion.mp4" type="video/mp4" />
    </video>
    <canvas id="fireworksCanvas"></canvas>
    <div class="gameContainer">
      <p id="resultText"></p>
      <div id="scoreDetails">
        <p><strong>‚è± Tiempo:</strong> <span id="finalTime">00:00</span></p>
        <p><strong>üîÅ Movimientos:</strong> <span id="finalMoves">0</span></p>
        <p><strong>üèÜ Mejores Puntajes:</strong></p>
        <ol id="topScores"><li>‚Äî</li><li>‚Äî</li><li>‚Äî</li><li>‚Äî</li><li>‚Äî</li></ol>
      </div>
    </div>
    <img src="assets/again.png" alt="Reintentar" id="playAgainButton" class="again-button" />
  </section>

  <!-- Audios -->
  <audio id="startSound" src="assets/start.mp3"></audio>
  <audio id="moveSound" src="assets/move.mp3"></audio>
  <audio id="winSound" src="assets/win.mp3"></audio>

  <!-- Phaser y l√≥gica -->
  <script src="https://cdn.jsdelivr.net/npm/phaser@3.60.0/dist/phaser.min.js"></script>
  <script src="game.js"></script>

  <!-- Script principal -->
  <script>
    const playButton = document.getElementById("playButton");
    const playAgainButton = document.getElementById("playAgainButton");
    const startSound = document.getElementById("startSound");

    function fadeToScreen(hideId, showId) {
      const hideEl = document.getElementById(hideId);
      const showEl = document.getElementById(showId);
      hideEl.style.display = "none";
      showEl.style.display = "block";
    }

    function iniciarJuego() {
      document.getElementById("bgSource").src = "assets/fondo.mp4";
      document.getElementById("backgroundVideo").load();
      fadeToScreen("screenStart", "screenGame");
      if (window.game) window.game.destroy(true);
      window.game = new Phaser.Game(config);
    }

    playButton.addEventListener("click", () => {
      const saved = localStorage.getItem("bam-player");
      if (saved) {
        iniciarJuego();
      } else {
        document.getElementById("screenStart").style.display = "none";
        document.getElementById("formScreen").style.display = "flex";
      }
    });

    playAgainButton.addEventListener("click", () => {
      iniciarJuego();
    });

    const splashVideo = document.getElementById("splashVideo");
    const splashImage = document.getElementById("splashImage");
    const splashScreen = document.getElementById("splashScreen");

    setTimeout(() => {
      splashImage.style.opacity = 0;
      splashVideo.style.display = "block";
      splashVideo.play();
    }, 300);

    splashVideo.addEventListener("ended", () => {
      splashScreen.remove();
      document.getElementById("screenStart").style.display = "block";
    });

    const formScreen = document.getElementById("formScreen");
    const playerForm = document.getElementById("playerForm");

    playerForm.addEventListener("submit", async (e) => {
      e.preventDefault();
      const name = document.getElementById("firstName").value.trim();
      const last = document.getElementById("lastName").value.trim();
      const email = document.getElementById("email").value.trim();
      const country = await fetch("https://ipapi.co/json/")
        .then(res => res.json())
        .then(data => data.country_name)
        .catch(() => "Desconocido");
      localStorage.setItem("bam-player", JSON.stringify({ name, last, email, country }));
      formScreen.style.display = "none";
      iniciarJuego();
    });
  </script>
</body>
</html>
